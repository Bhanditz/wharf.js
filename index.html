<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <script src="jszip.min.js"></script>
    <script src="bridge.js"></script>
    <script src="butlerweb.js"></script>
    <script>
    'use strict'

    var onContainer = function (container) {
      console.log("Container = ", container.entries)
      var firstEntry = container.entries[0]
      firstEntry.read().then(function (data) {
        console.log("first entry: ", firstEntry.path, firstEntry.size, data, data.byteLength)
      })

      var xhr = new XMLHttpRequest()
      xhr.responseType = "arraybuffer"
      xhr.open("GET", "sampledata/alcott.pwr.sig")
      xhr.onload = function () {
        var signatureBytes = xhr.response
        console.log("signatureBytes = ", signatureBytes, signatureBytes.byteLength)
        window.wharf.Diff(signatureBytes, container)
      }
      xhr.onerror = function (e) {
        console.log('xhr error = ', e)
      }
      xhr.send()
    }

    document.addEventListener("DOMContentLoaded", function () {
      var fileinputs = document.querySelectorAll(".file-input")
      for (var i = 0; i < fileinputs.length; i++) {
        var fileinput = fileinputs[i]
        window.Uppa(fileinput, onContainer)
      }
    })
    </script>
  </head>
  <body>
    <h1>Butler web!</h1>
    <div class="upload-target">
      <h2>Upload a .zip file</h2>
      <input class="file-input" type="file">
    </div>
    <div class="upload-target">
      <h2>...or a directory (Chrome, Firefox Nightly and Edge only)</h2>
      <input class="file-input" type="file" webkitdirectory directory>
    </div>
  </body>
</html>
