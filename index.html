<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <script src="jszip.min.js"></script>
    <script src="bridge.js"></script>
    <script src="butlerweb.js"></script>
    <script>
    'use strict'

    var onContainer = function (container) {
      var sigInput = document.querySelector(".signature-input")
      if (!sigInput.files) {
        throw new Error("Missing signature!")
      }

      // var xhr = new XMLHttpRequest()
      // xhr.responseType = "arraybuffer"
      // xhr.open("GET", "sampledata/alcott.pwr.sig?t=" + (+new Date))
      // xhr.onload = function () {
      //   var signatureBytes = xhr.response
      //   window.wharf.Diff(signatureBytes, container)
      // }
      // xhr.onerror = function (e) {
      //   console.log('xhr error = ', e)
      // }
      // xhr.send()

      Uppa.read(sigInput.files[0]).then(function (signatureBytes) {
        window.wharf.Diff(signatureBytes, container)
      })
    }

    document.addEventListener("DOMContentLoaded", function () {
      var fileinputs = document.querySelectorAll(".file-input")
      for (var i = 0; i < fileinputs.length; i++) {
        var fileinput = fileinputs[i]
        window.Uppa(fileinput, onContainer)
      }
    })
    </script>
  </head>
  <body>
    <h1>Butler web!</h1>
    <div class="upload-target">
      <h2>Pick a signature file</h2>
      <input class="signature-input" type="file">
    </div>
    <div class="upload-target">
      <h2>Upload a .zip file</h2>
      <input class="file-input" type="file">
    </div>
    <div class="upload-target">
      <h2>...or a directory (Chrome, Firefox Nightly and Edge only)</h2>
      <input class="file-input" type="file" webkitdirectory directory>
    </div>
  </body>
</html>
